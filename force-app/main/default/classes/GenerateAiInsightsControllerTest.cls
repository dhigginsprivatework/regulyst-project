@IsTest
private class GenerateAiInsightsControllerTest {
    
    @IsTest
    static void testGetPromptDetails() {
        // Create related records
        Framework__c framework = new Framework__c(Name = ProjectConstants.PROJECT_STANDARDS_ALIGNMENT_FRAMEWORK_TEST_NAME);
        insert framework;

        Project_Control_Requirement__c requirement = new Project_Control_Requirement__c(
            Name = 'Access Control',
            Framework__c = framework.Id
        );
        insert requirement;

        Evidence__c evidence = new Evidence__c(
            Project_Control_Requirement__c = requirement.Id
        );
        insert evidence;

        Test.startTest();
        String prompt = GenerateAiInsightsController.getPromptDetails(evidence.Id);
        Test.stopTest();

        System.assertNotEquals(null, prompt);
        System.assert(prompt.contains('Access Control'));
        System.assert(prompt.contains('ISO 27001'));
    }

    @IsTest
    static void testUpdateAISummary() {
        // Create an Evidence record
        Evidence__c evidence = new Evidence__c();
        insert evidence;

        String summaryText = 'This is a test summary generated by AI.';

        Test.startTest();
        GenerateAiInsightsController.updateAISummary(evidence.Id, summaryText);
        Test.stopTest();

        Evidence__c updatedEvidence = [SELECT AI_Summary__c FROM Evidence__c WHERE Id = :evidence.Id];
        System.assertEquals(summaryText, updatedEvidence.AI_Summary__c);
    }
}
